{% extends "base.html" %}
{% block title %}My Complaints{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto mt-10 mb-12">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-3xl font-bold text-slate-800 flex items-center">
      ğŸ“‹ My Complaints
    </h2>
    <a href="{{ url_for('complaints.submit') }}"
       class="px-4 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700 transition">
      â• New Complaint
    </a>
  </div>

  <!-- Complaints Table -->
  <div class="bg-white/90 backdrop-blur-md p-6 rounded-2xl shadow-lg">
    {% if complaints %}
      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden">
          <thead class="bg-indigo-100 text-indigo-800">
            <tr>
              <th class="px-4 py-2 text-left border-b border-indigo-200">Type</th>
              <th class="px-4 py-2 text-left border-b border-indigo-200">Area</th>
              <th class="px-4 py-2 text-left border-b border-indigo-200">Description</th>
              <th class="px-4 py-2 text-left border-b border-indigo-200">Status</th>
              <th class="px-4 py-2 text-left border-b border-indigo-200">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for c in complaints %}
            <tr class="hover:bg-indigo-50 transition">
              <td class="px-4 py-2 text-gray-700 font-medium">{{ c.complaint_type.name }}</td>
              <td class="px-4 py-2 text-gray-700">{{ c.area.name }}</td>
              <td class="px-4 py-2 text-gray-600">{{ c.text }}</td>
              <td class="px-4 py-2">
                {% if c.status == 'resolved' %}
                  <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700 border border-green-300">Resolved</span>
                {% else %}
                  <span class="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-700 border border-yellow-300">Pending</span>
                {% endif %}
              </td>
              <td class="px-4 py-2">
                {% if c.user_id == current_user.id %}
                  <a href="{{ url_for('complaints.edit_complaint', complaint_id=c.id) }}"
                     class="text-indigo-600 hover:text-indigo-800 font-medium transition">âœï¸ Edit</a>
                  <span class="mx-1 text-gray-400">|</span>
                  <form method="post"
                        action="{{ url_for('complaints.delete_complaint', complaint_id=c.id) }}"
                        style="display:inline;"
                        onsubmit="return confirm('Delete this complaint?');">
                    <button type="submit"
                            class="text-red-600 hover:text-red-800 font-medium transition">ğŸ—‘ï¸ Delete</button>
                  </form>
                {% else %}
                  <span class="text-gray-400 italic">Read-only</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center text-gray-600 py-10">
        <p class="text-lg">No complaints submitted yet.</p>
        <a href="{{ url_for('complaints.submit') }}"
           class="mt-3 inline-block px-5 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700 transition">
          Submit Now
        </a>
      </div>
    {% endif %}
  </div>
</div>

<!-- Flash Messages -->
<div id="toasts" class="fixed top-6 right-6 space-y-2 z-50">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="p-3 rounded-lg shadow-lg text-sm font-medium
                    {{ 'bg-green-100 text-green-800 border border-green-300' if category=='success' else 'bg-red-100 text-red-800 border border-red-300' }}">
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<!-- Flash Auto-hide -->
<script>
window.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    const toasts = document.getElementById('toasts');
    if (toasts) toasts.innerHTML = '';
  }, 3000);
});
</script>
{% endblock %}
